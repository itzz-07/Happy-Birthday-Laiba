<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday LAIBA! ðŸŽ‰</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8a2be2;
            --secondary: #9370db;
            --accent: #d8bfd8;
            --light: #f8f0ff;
            --dark: #4b0082;
            --pink: #ff6b8b;
            --heart-red: #ff4757;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #e6e6fa 0%, #d8bfd8 50%, #9370db 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(45deg, #8a2be2, #9370db, #ba55d3);
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 5rem;
            color: white;
            text-shadow: 3px 3px 0px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .header h2 {
            color: white;
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 30px;
        }

        .birthday-person {
            font-size: 3rem;
            color: var(--pink);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(255, 107, 139, 0.5);
            background: linear-gradient(45deg, #ff6b8b, #ff8fab);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Wishes Section */
        .wishes-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f0ff 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.1);
        }

        .section-title {
            font-size: 2rem;
            background: linear-gradient(45deg, #8a2be2, #9370db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #8a2be2;
            display: inline-block;
        }

        .wish-form {
            background: linear-gradient(135deg, #f8f0ff 0%, #e6e6fa 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(138, 43, 226, 0.2);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--dark);
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #d8bfd8;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .form-control:focus {
            border-color: #8a2be2;
            outline: none;
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.2);
            background: #f8f0ff;
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(45deg, #8a2be2, #9370db, #ba55d3);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(138, 43, 226, 0.6);
            background: linear-gradient(45deg, #9370db, #ba55d3, #8a2be2);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Upload Progress */
        .upload-progress {
            margin: 10px 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e6e6fa;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #8a2be2, #9370db);
            width: 0%;
            transition: width 0.3s;
        }

        /* Wishes List */
        .wishes-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .wish-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f0ff 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(138, 43, 226, 0.05);
            border-left: 5px solid #8a2be2;
            transition: transform 0.3s;
            border: 1px solid rgba(138, 43, 226, 0.1);
        }

        .wish-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.1);
        }

        .wish-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .wish-name {
            font-weight: 700;
            color: #8a2be2;
            font-size: 1.2rem;
        }

        .wish-time {
            color: #9370db;
            font-size: 0.9rem;
        }

        .wish-message {
            line-height: 1.6;
            color: #555;
        }

        /* Like Button */
        .like-btn {
            background: transparent;
            border: 2px solid #8a2be2;
            color: #8a2be2;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .like-btn:hover {
            background: linear-gradient(45deg, #8a2be2, #9370db);
            color: white;
        }

        .like-btn.liked {
            background: linear-gradient(45deg, #8a2be2, #9370db);
            color: white;
        }

        /* Birthday Stats */
        .stats-section {
            background: linear-gradient(135deg, #8a2be2 0%, #9370db 50%, #ba55d3 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.3);
            position: relative;
            overflow: hidden;
        }

        .stats-section h3 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Memories Section */
        .memories-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f0ff 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.1);
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .photo-item {
            border-radius: 15px;
            overflow: hidden;
            height: 200px;
            position: relative;
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.1);
            transition: transform 0.3s;
            border: 1px solid rgba(138, 43, 226, 0.2);
        }

        .photo-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.2);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .photo-item:hover img {
            transform: scale(1.1);
        }

        .photo-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(138, 43, 226, 0.8));
            color: white;
            padding: 10px;
            font-size: 0.9rem;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .photo-item:hover .photo-caption {
            transform: translateY(0);
        }

        /* Countdown Timer */
        .countdown-section {
            background: linear-gradient(45deg, #8a2be2, #9370db, #ba55d3);
            color: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.3);
        }

        .countdown-title {
            font-size: 2.2rem;
            margin-bottom: 30px;
        }

        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .countdown-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            min-width: 120px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s;
        }

        .countdown-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }

        .countdown-value {
            font-size: 3.5rem;
            font-weight: 700;
            line-height: 1;
            color: #ffd700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .countdown-label {
            font-size: 1.1rem;
            margin-top: 10px;
            opacity: 0.9;
            font-weight: 600;
        }

        /* Image Upload Section */
        .image-upload-section {
            background: linear-gradient(135deg, #f8f0ff 0%, #e6e6fa 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px dashed #9370db;
        }

        .upload-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .upload-btn {
            flex: 1;
            background: #9370db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            position: relative;
        }

        .upload-btn:hover {
            background: #8a2be2;
            transform: translateY(-2px);
        }

        .upload-btn input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }

        .url-input-container {
            margin-top: 10px;
        }

        .url-input-container input {
            width: 100%;
            padding: 10px;
            border: 2px solid #9370db;
            border-radius: 10px;
            margin-top: 5px;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin: 15px auto;
            border-radius: 10px;
            overflow: hidden;
            display: none;
            border: 2px solid #9370db;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #4b0082 0%, #8a2be2 100%);
            color: white;
            border-radius: 20px;
            margin-top: 40px;
        }

        .footer p {
            margin-bottom: 10px;
        }

        .heart {
            color: var(--pink);
        }

        #footerName {
            color: var(--pink);
            font-weight: 700;
            text-shadow: 0 0 5px rgba(255, 107, 139, 0.5);
            background: linear-gradient(45deg, #ff6b8b, #ff8fab);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(45deg, #8a2be2, #9370db);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.5s;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 400px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Music Player */
        .music-player {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f0ff 100%);
            border-radius: 50px;
            padding: 10px 20px;
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 100;
            border: 1px solid rgba(138, 43, 226, 0.2);
        }

        .music-btn {
            background: linear-gradient(45deg, #8a2be2, #9370db);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .music-btn:hover {
            background: linear-gradient(45deg, #9370db, #ba55d3);
            transform: scale(1.1);
        }

        .song-title {
            font-weight: 600;
            color: #8a2be2;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px 10px;
                margin-bottom: 20px;
            }
            
            .header h1 {
                font-size: 3rem;
                line-height: 1.2;
            }
            
            .header h2 {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }
            
            .birthday-person {
                font-size: 2rem;
                letter-spacing: 1px;
            }
            
            .upload-options {
                flex-direction: column;
            }
            
            .photo-grid {
                grid-template-columns: 1fr;
            }
            
            .photo-item {
                height: 250px;
            }
            
            .toast {
                bottom: 80px;
                left: 15px;
                right: 15px;
                text-align: center;
            }
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Music Player -->
    <div class="music-player">
        <div class="music-btn" id="playBtn">
            <i class="fas fa-play"></i>
        </div>
        <div class="song-title">Happy Birthday Song</div>
        <audio id="birthdaySong" loop>
            <source src="https://assets.mixkit.co/music/preview/mixkit-happy-birthday-to-you-443.mp3" type="audio/mpeg">
        </audio>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Wish submitted successfully!</span>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Happy Birthday!</h1>
            <h2>It's your special day</h2>
            <div class="birthday-person" id="birthdayPerson">LAIBA!</div>
        </header>

        <!-- Countdown Timer -->
        <section class="countdown-section">
            <h2 class="countdown-title">Celebration Countdown</h2>
            <div class="countdown-timer">
                <div class="countdown-item">
                    <div class="countdown-value" id="days">00</div>
                    <div class="countdown-label">Days</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-value" id="hours">00</div>
                    <div class="countdown-label">Hours</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-value" id="minutes">00</div>
                    <div class="countdown-label">Minutes</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-value" id="seconds">00</div>
                    <div class="countdown-label">Seconds</div>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Wishes Section -->
            <div class="wishes-section">
                <h2 class="section-title">Send Birthday Wishes</h2>
                
                <!-- Wish Form -->
                <div class="wish-form">
                    <form id="wishForm">
                        <div class="form-group">
                            <label for="name"><i class="fas fa-user"></i> Your Name</label>
                            <input type="text" id="name" class="form-control" placeholder="Enter your name" required>
                        </div>
                        <div class="form-group">
                            <label for="message"><i class="fas fa-comment"></i> Your Message</label>
                            <textarea id="message" class="form-control" placeholder="Write your birthday wish here..." required></textarea>
                        </div>
                        <button type="submit" class="btn" id="submitWishBtn">
                            <i class="fas fa-paper-plane"></i> Send Wish
                        </button>
                    </form>
                </div>

                <!-- Wishes List -->
                <h3 class="section-title">Recent Wishes</h3>
                <div class="wishes-list" id="wishesList">
                    <!-- Wishes loaded from Supabase -->
                    <div class="wish-item loading">
                        <div class="wish-header">
                            <div class="wish-name">Loading wishes...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Section -->
            <div class="stats-section">
                <h3>Birthday Stats</h3>
                <div class="stat-item">
                    <div class="stat-label">Total Wishes</div>
                    <div class="stat-value" id="totalWishes">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Total Memories</div>
                    <div class="stat-value" id="totalMemories">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Today's Wishes</div>
                    <div class="stat-value" id="wishersToday">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Celebration Level</div>
                    <div class="stat-value" id="celebrationLevel">ðŸŽ‚</div>
                </div>
                
                <!-- Birthday Progress -->
                <h3 style="margin-top: 30px;">Birthday Meter</h3>
                <div style="background: rgba(255,255,255,0.2); height: 20px; border-radius: 10px; margin-top: 15px; overflow: hidden;">
                    <div id="birthdayMeter" style="height: 100%; background: linear-gradient(45deg, #ffd700, #ffed4e); width: 0%; border-radius: 10px; transition: width 1s;"></div>
                </div>
                <div style="text-align: center; margin-top: 10px; font-size: 0.9rem;">
                    <span id="meterText">Birthday excitement level</span>
                </div>
            </div>
        </div>

        <!-- Memories Section with Image Upload -->
        <section class="memories-section">
            <h2 class="section-title">Memory Lane</h2>
            <p>Add your favorite memories LAIBA! <span id="uploadStatus"></span></p>
            
            <!-- Image Upload Section -->
            <div class="image-upload-section">
                <h4><i class="fas fa-cloud-upload-alt"></i> Add Memory Photo</h4>
                <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i> Photos are saved to cloud storage
                </p>
                
                <!-- Upload Progress -->
                <div class="upload-progress" id="uploadProgress">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Uploading...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
                
                <div class="upload-options">
                    <label class="upload-btn" for="memoryUpload">
                        <i class="fas fa-upload"></i> Upload from Computer
                        <input type="file" id="memoryUpload" accept="image/*">
                    </label>
                    <button class="upload-btn" id="urlUploadBtn">
                        <i class="fas fa-link"></i> Use Image URL
                    </button>
                </div>
                
                <!-- URL Input Container -->
                <div class="url-input-container" id="urlInputContainer" style="display: none;">
                    <label for="memoryUrl">Image URL:</label>
                    <input type="url" id="memoryUrl" class="form-control" placeholder="https://example.com/image.jpg">
                    <button class="btn" onclick="loadUrlImage()" style="margin-top: 10px; width: 100%;">
                        <i class="fas fa-external-link-alt"></i> Load Image
                    </button>
                </div>
                
                <!-- Image Preview -->
                <div class="image-preview" id="imagePreview">
                    <img id="previewImage" src="" alt="Preview">
                    <div style="text-align: center; padding: 10px; background: rgba(0,0,0,0.5); color: white;">
                        Preview
                    </div>
                </div>
                
                <!-- Caption Input -->
                <div style="margin-top: 20px;">
                    <label for="memoryCaption" style="font-weight: 600; margin-bottom: 5px; display: block;">
                        <i class="fas fa-pencil-alt"></i> Memory Caption
                    </label>
                    <input type="text" id="memoryCaption" class="form-control" placeholder="Describe this memory...">
                    
                    <!-- Upload Button -->
                    <button class="btn" onclick="addMemory()" id="addMemoryBtn" style="margin-top: 15px; width: 100%;" disabled>
                        <i class="fas fa-plus"></i> Save Memory to Cloud
                    </button>
                    
                    <p style="color: #666; font-size: 0.8rem; margin-top: 10px; text-align: center;">
                        <i class="fas fa-shield-alt"></i> Photo will be permanently saved in cloud storage
                    </p>
                </div>
            </div>
            
            <!-- Memory Grid -->
            <div class="photo-grid" id="memoryGrid">
                <!-- Memories loaded from Supabase -->
                <div class="photo-item loading">
                    <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #8a2be2;">
                        <i class="fas fa-spinner fa-spin"></i> Loading memories...
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Made with <span class="heart"><i class="fas fa-heart"></i></span> for <span id="footerName">LAIBA</span></p>
            <p>This birthday page updates in realtime! Share with friends to add wishes.</p>
            <p>Â© 2026 Birthday Celebration | All photos are stored in secure cloud</p>
            <div style="margin-top: 20px;">
                <button class="btn" onclick="sharePage()">
                    <i class="fas fa-share-alt"></i> Share This Page
                </button>
                <button class="btn" onclick="refreshData()" style="margin-left: 10px;">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </footer>
    </div>

    <!-- Main JavaScript -->
    <script>
        // ===================== SUPABASE CONFIGURATION =====================
        // âœ… Aapke credentials yaha daale hain
        const SUPABASE_URL = "https://rfpxzzoiztxpjzogffep.supabase.co";
        const SUPABASE_ANON_KEY = "sb_publishable_9VhZeABPTC_G95aGnonLig_yU22dvyh";
        
        // Initialize Supabase
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Birthday Configuration
        const BIRTHDAY_NAME = "LAIBA";
        const BIRTHDAY_DATE = "February 16, 2026 00:00:00";
        const PAGE_TITLE = "Happy Birthday LAIBA! ðŸŽ‰";

        // ===================== DOM ELEMENTS =====================
        const wishForm = document.getElementById('wishForm');
        const wishesList = document.getElementById('wishesList');
        const memoryGrid = document.getElementById('memoryGrid');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const playBtn = document.getElementById('playBtn');
        const birthdaySong = document.getElementById('birthdaySong');
        const memoryUpload = document.getElementById('memoryUpload');
        const imagePreview = document.getElementById('imagePreview');
        const previewImage = document.getElementById('previewImage');
        const memoryUrlInput = document.getElementById('memoryUrl');
        const urlInputContainer = document.getElementById('urlInputContainer');
        const urlUploadBtn = document.getElementById('urlUploadBtn');
        const addMemoryBtn = document.getElementById('addMemoryBtn');
        const memoryCaption = document.getElementById('memoryCaption');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressFill = document.getElementById('progressFill');
        const progressPercent = document.getElementById('progressPercent');
        const submitWishBtn = document.getElementById('submitWishBtn');

        // Stats Elements
        const totalWishesEl = document.getElementById('totalWishes');
        const totalMemoriesEl = document.getElementById('totalMemories');
        const wishersTodayEl = document.getElementById('wishersToday');
        const celebrationLevelEl = document.getElementById('celebrationLevel');
        const birthdayMeter = document.getElementById('birthdayMeter');
        const meterText = document.getElementById('meterText');

        // Countdown Elements
        const daysEl = document.getElementById('days');
        const hoursEl = document.getElementById('hours');
        const minutesEl = document.getElementById('minutes');
        const secondsEl = document.getElementById('seconds');

        // ===================== GLOBAL VARIABLES =====================
        let isPlaying = false;
        let currentImageFile = null;
        let currentImageUrl = null;
        let uploadInProgress = false;
        let totalWishesCount = 0;
        let totalMemoriesCount = 0;

        // ===================== UTILITY FUNCTIONS =====================
        
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add('show');
            
            if (type === 'error') {
                toast.style.background = 'linear-gradient(45deg, #ff4757, #ff6b81)';
                toast.querySelector('i').className = 'fas fa-exclamation-circle';
            } else if (type === 'warning') {
                toast.style.background = 'linear-gradient(45deg, #ffa502, #ffb142)';
                toast.querySelector('i').className = 'fas fa-exclamation-triangle';
            } else {
                toast.style.background = 'linear-gradient(45deg, #8a2be2, #9370db)';
                toast.querySelector('i').className = 'fas fa-check-circle';
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) {
                const minutes = Math.floor(diff / 60000);
                return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            }
            
            if (date.toDateString() === now.toDateString()) {
                return `Today at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            }
            
            const yesterday = new Date(now);
            yesterday.setDate(yesterday.getDate() - 1);
            if (date.toDateString() === yesterday.toDateString()) {
                return `Yesterday at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            }
            
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        // ===================== IMAGE UPLOAD FUNCTIONS =====================
        
        // Toggle URL input
        urlUploadBtn.addEventListener('click', function(e) {
            e.preventDefault();
            urlInputContainer.style.display = urlInputContainer.style.display === 'none' ? 'block' : 'none';
        });

        // Load image from URL
        function loadUrlImage() {
            const url = memoryUrlInput.value.trim();
            if (!url) {
                showToast('Please enter an image URL', 'error');
                return;
            }
            
            previewImage.src = url;
            imagePreview.style.display = 'block';
            currentImageUrl = url;
            currentImageFile = null;
            addMemoryBtn.disabled = !memoryCaption.value.trim();
            
            // Test if image loads
            previewImage.onload = function() {
                showToast('Image loaded successfully!');
            };
            previewImage.onerror = function() {
                showToast('Failed to load image. Please check URL.', 'error');
                imagePreview.style.display = 'none';
                currentImageUrl = null;
            };
        }

        // Handle file upload selection
        memoryUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Check file type
            if (!file.type.match('image.*')) {
                showToast('Please select an image file (JPEG, PNG, GIF)', 'error');
                return;
            }
            
            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showToast('File size should be less than 5MB', 'error');
                return;
            }
            
            currentImageFile = file;
            currentImageUrl = null;
            
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                imagePreview.style.display = 'block';
                addMemoryBtn.disabled = !memoryCaption.value.trim();
                showToast('Image selected. Add a caption and save!');
            };
            reader.readAsDataURL(file);
        });

        // Enable/disable save button based on caption
        memoryCaption.addEventListener('input', function() {
            addMemoryBtn.disabled = !this.value.trim() || (!currentImageFile && !currentImageUrl);
        });

        // ===================== SUPABASE UPLOAD FUNCTION =====================
        
        async function uploadToSupabaseStorage(file) {
            try {
                // Generate unique filename
                const fileExt = file.name.split('.').pop();
                const fileName = `${Date.now()}_${Math.random().toString(36).substring(2)}.${fileExt}`;
                const filePath = `memories/${fileName}`;
                
                // Show progress
                uploadProgress.style.display = 'block';
                progressFill.style.width = '0%';
                progressPercent.textContent = '0%';
                
                // Upload to Supabase Storage
                const { data, error } = await supabase.storage
                    .from('birthday-memories')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });
                
                if (error) throw error;
                
                // Simulate progress for better UX
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 10;
                    progressFill.style.width = `${progress}%`;
                    progressPercent.textContent = `${progress}%`;
                    
                    if (progress >= 100) {
                        clearInterval(progressInterval);
                        
                        // Get public URL
                        const { data: urlData } = supabase.storage
                            .from('birthday-memories')
                            .getPublicUrl(filePath);
                        
                        // Hide progress
                        setTimeout(() => {
                            uploadProgress.style.display = 'none';
                        }, 500);
                        
                        return urlData.publicUrl;
                    }
                }, 200);
                
                // Wait for upload to complete
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Get public URL
                const { data: urlData } = supabase.storage
                    .from('birthday-memories')
                    .getPublicUrl(filePath);
                
                return urlData.publicUrl;
                
            } catch (error) {
                uploadProgress.style.display = 'none';
                console.error('Upload error:', error);
                throw error;
            }
        }

        // ===================== ADD MEMORY FUNCTION =====================
        
        async function addMemory() {
            if (uploadInProgress) {
                showToast('Please wait, upload in progress...', 'warning');
                return;
            }
            
            const caption = memoryCaption.value.trim();
            
            if (!caption) {
                showToast('Please enter a caption for the memory', 'error');
                return;
            }
            
            if (!currentImageFile && !currentImageUrl) {
                showToast('Please select an image first', 'error');
                return;
            }
            
            try {
                uploadInProgress = true;
                addMemoryBtn.disabled = true;
                addMemoryBtn.innerHTML = '<div class="spinner"></div> Uploading...';
                
                let imageUrl = currentImageUrl;
                
                // If file is selected, upload to Supabase
                if (currentImageFile) {
                    showToast('Uploading image to cloud storage...');
                    imageUrl = await uploadToSupabaseStorage(currentImageFile);
                    showToast('Image uploaded to cloud!');
                }
                
                // Save to Supabase database
                const { data, error } = await supabase
                    .from('memories')
                    .insert([
                        {
                            image_url: imageUrl,
                            caption: caption,
                            uploaded_by: 'Guest',
                            created_at: new Date().toISOString(),
                            likes: 0
                        }
                    ])
                    .select();
                
                if (error) throw error;
                
                // Add to grid
                addMemoryToGrid(data[0]);
                
                // Reset form
                memoryCaption.value = '';
                memoryUpload.value = '';
                memoryUrlInput.value = '';
                imagePreview.style.display = 'none';
                previewImage.src = '';
                currentImageFile = null;
                currentImageUrl = null;
                urlInputContainer.style.display = 'none';
                
                // Update stats
                totalMemoriesCount++;
                updateStats();
                
                showToast('Memory saved permanently to cloud! ðŸŽ‰');
                
            } catch (error) {
                console.error('Error saving memory:', error);
                showToast('Failed to save memory. Please try again.', 'error');
            } finally {
                uploadInProgress = false;
                addMemoryBtn.disabled = false;
                addMemoryBtn.innerHTML = '<i class="fas fa-plus"></i> Save Memory to Cloud';
            }
        }

        // ===================== WISHES FUNCTIONS =====================
        
        // Submit wish
        wishForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const message = document.getElementById('message').value.trim();
            
            if (!name || !message) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            try {
                submitWishBtn.disabled = true;
                submitWishBtn.innerHTML = '<div class="spinner"></div> Sending...';
                
                // Save to Supabase
                const { data, error } = await supabase
                    .from('wishes')
                    .insert([
                        {
                            name: name,
                            message: message,
                            created_at: new Date().toISOString(),
                            likes: 0,
                            liked_by: []
                        }
                    ])
                    .select();
                
                if (error) throw error;
                
                // Add to DOM
                addWishToDOM(data[0]);
                
                // Reset form
                wishForm.reset();
                
                // Update stats
                totalWishesCount++;
                updateStats();
                
                showToast('Wish saved to cloud! ðŸŽ‰');
                
                // Play sound
                const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-happy-crowd-laugh-464.mp3');
                audio.volume = 0.3;
                audio.play().catch(() => {});
                
            } catch (error) {
                console.error('Error saving wish:', error);
                showToast('Failed to save wish. Please try again.', 'error');
            } finally {
                submitWishBtn.disabled = false;
                submitWishBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Wish';
            }
        });

        // ===================== DISPLAY FUNCTIONS =====================
        
        function addWishToDOM(wish) {
            const wishItem = document.createElement('div');
            wishItem.className = 'wish-item';
            wishItem.dataset.id = wish.id;
            wishItem.innerHTML = `
                <div class="wish-header">
                    <div class="wish-name">${wish.name}</div>
                    <div class="wish-time">${formatDate(wish.created_at)}</div>
                </div>
                <div class="wish-message">${wish.message}</div>
                <button class="like-btn" onclick="likeWish('${wish.id}', this)">
                    <i class="fas fa-heart"></i> 
                    <span class="like-count">${wish.likes || 0}</span>
                </button>
            `;
            
            // Add to beginning of list
            if (wishesList.children.length > 0 && wishesList.children[0].classList.contains('loading')) {
                wishesList.removeChild(wishesList.children[0]);
            }
            
            wishesList.insertBefore(wishItem, wishesList.firstChild);
        }

        function addMemoryToGrid(memory) {
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';
            photoItem.innerHTML = `
                <img src="${memory.image_url}" 
                     alt="${memory.caption}" 
                     onerror="this.src='https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'">
                <div class="photo-caption">${memory.caption}</div>
            `;
            
            // Remove loading message if present
            if (memoryGrid.children.length > 0 && memoryGrid.children[0].classList.contains('loading')) {
                memoryGrid.removeChild(memoryGrid.children[0]);
            }
            
            memoryGrid.insertBefore(photoItem, memoryGrid.firstChild);
        }

        // ===================== LOAD DATA FUNCTIONS =====================
        
        async function loadWishes() {
            try {
                const { data, error } = await supabase
                    .from('wishes')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(50);
                
                if (error) throw error;
                
                // Clear loading message
                wishesList.innerHTML = '';
                
                if (data.length === 0) {
                    wishesList.innerHTML = `
                        <div class="wish-item" style="text-align: center; color: #666;">
                            <i class="fas fa-gift" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>No wishes yet. Be the first to wish LAIBA!</p>
                        </div>
                    `;
                    return;
                }
                
                // Add all wishes
                data.forEach(wish => {
                    addWishToDOM(wish);
                });
                
                totalWishesCount = data.length;
                updateStats();
                
            } catch (error) {
                console.error('Error loading wishes:', error);
                showToast('Error loading wishes', 'error');
            }
        }

        async function loadMemories() {
            try {
                const { data, error } = await supabase
                    .from('memories')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                // Clear loading message
                memoryGrid.innerHTML = '';
                
                if (data.length === 0) {
                    memoryGrid.innerHTML = `
                        <div class="photo-item" style="display: flex; justify-content: center; align-items: center; color: #8a2be2;">
                            <div style="text-align: center; padding: 20px;">
                                <i class="fas fa-images" style="font-size: 3rem; margin-bottom: 10px;"></i>
                                <p>No memories yet. Add the first one!</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // Add all memories
                data.forEach(memory => {
                    addMemoryToGrid(memory);
                });
                
                totalMemoriesCount = data.length;
                updateStats();
                
            } catch (error) {
                console.error('Error loading memories:', error);
                showToast('Error loading memories', 'error');
            }
        }

        // ===================== LIKE FUNCTION =====================
        
        async function likeWish(wishId, button) {
            try {
                const likeCount = button.querySelector('.like-count');
                let count = parseInt(likeCount.textContent);
                const isLiked = button.classList.contains('liked');
                
                if (isLiked) {
                    count--;
                    button.classList.remove('liked');
                } else {
                    count++;
                    button.classList.add('liked');
                    
                    // Play sound
                    const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3');
                    audio.volume = 0.2;
                    audio.play().catch(() => {});
                }
                
                likeCount.textContent = count;
                
                // Update in Supabase
                const { error } = await supabase
                    .from('wishes')
                    .update({ likes: count })
                    .eq('id', wishId);
                
                if (error) throw error;
                
                updateStats();
                
            } catch (error) {
                console.error('Error updating like:', error);
                showToast('Error updating like', 'error');
            }
        }

        // ===================== STATS FUNCTIONS =====================
        
        function updateStats() {
            totalWishesEl.textContent = totalWishesCount;
            totalMemoriesEl.textContent = totalMemoriesCount;
            
            // Calculate today's wishes
            const today = new Date().toDateString();
            const wishItems = document.querySelectorAll('.wish-item .wish-time');
            let todayCount = 0;
            
            wishItems.forEach(timeElement => {
                if (timeElement.textContent.includes('Today') || 
                    timeElement.textContent.includes('Just now') ||
                    timeElement.textContent.includes('minute') ||
                    timeElement.textContent.includes('hour')) {
                    todayCount++;
                }
            });
            
            wishersTodayEl.textContent = todayCount;
            
            // Celebration level
            let level = 'ðŸŽ‚';
            if (totalWishesCount > 20) level = 'ðŸŽ‰';
            if (totalWishesCount > 50) level = 'ðŸŽŠ';
            if (totalWishesCount > 100) level = 'ðŸ¥³';
            if (totalWishesCount > 200) level = 'ðŸŽ‡';
            
            celebrationLevelEl.textContent = level;
            
            // Progress meter
            const meterValue = Math.min(100, Math.floor((totalWishesCount / 100) * 100));
            birthdayMeter.style.width = meterValue + '%';
            meterText.textContent = `Birthday excitement: ${meterValue}%`;
        }

        // ===================== COUNTDOWN FUNCTIONS =====================
        
        function updateCountdown() {
            const birthday = new Date(BIRTHDAY_DATE).getTime();
            const now = new Date().getTime();
            
            let targetDate = new Date(BIRTHDAY_DATE);
            if (targetDate.getTime() < now) {
                targetDate.setFullYear(targetDate.getFullYear() + 1);
            }
            
            const distance = targetDate.getTime() - now;
            
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            daysEl.textContent = days.toString().padStart(2, '0');
            hoursEl.textContent = hours.toString().padStart(2, '0');
            minutesEl.textContent = minutes.toString().padStart(2, '0');
            secondsEl.textContent = seconds.toString().padStart(2, '0');
            
            // Check if it's birthday
            if (days === 0 && hours < 24) {
                document.querySelector('.countdown-title').textContent = "It's Birthday Time! ðŸŽ‰";
                
                if (hours === 0 && minutes === 0 && seconds < 10) {
                    document.querySelector('.countdown-title').textContent = "Happy Birthday LAIBA! ðŸ¥³";
                }
            } else if (days === 1) {
                document.querySelector('.countdown-title').textContent = "Birthday is Tomorrow! ðŸŽŠ";
            } else if (days < 7) {
                document.querySelector('.countdown-title').textContent = `${days} Days to LAIBA's Birthday!`;
            }
        }

        // ===================== MUSIC PLAYER =====================
        
        playBtn.addEventListener('click', function() {
            if (isPlaying) {
                birthdaySong.pause();
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                birthdaySong.play().catch(e => {
                    console.log("Audio play failed:", e);
                    showToast('Could not play audio', 'error');
                });
                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
            isPlaying = !isPlaying;
        });

        // ===================== OTHER FUNCTIONS =====================
        
        function sharePage() {
            if (navigator.share) {
                navigator.share({
                    title: `Happy Birthday ${BIRTHDAY_NAME}!`,
                    text: `Send birthday wishes to ${BIRTHDAY_NAME} on this interactive page!`,
                    url: window.location.href,
                })
                .then(() => showToast('Thanks for sharing!'))
                .catch((error) => console.log('Error sharing:', error));
            } else {
                navigator.clipboard.writeText(window.location.href);
                showToast('Link copied to clipboard!');
            }
        }

        async function refreshData() {
            showToast('Refreshing data...');
            await Promise.all([loadWishes(), loadMemories()]);
            showToast('Data refreshed!');
        }

        // ===================== INITIALIZATION =====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Set page title and name
            document.title = PAGE_TITLE;
            document.getElementById('birthdayPerson').textContent = BIRTHDAY_NAME;
            document.getElementById('footerName').textContent = BIRTHDAY_NAME;
            
            // Start countdown
            updateCountdown();
            setInterval(updateCountdown, 1000);
            
            // Check if birthday has arrived
            const birthday = new Date(BIRTHDAY_DATE).getTime();
            const now = new Date().getTime();
            
            if (now >= birthday) {
                document.querySelector('.header h2').textContent = "Today is LAIBA's Birthday! ðŸ¥³";
            } else if (now >= birthday - 86400000) {
                document.querySelector('.header h2').textContent = "LAIBA's birthday is tomorrow! ðŸŽŠ";
            }
            
            // Load data
            loadWishes();
            loadMemories();
            
            // Initialize stats
            updateStats();
        });
    </script>
</body>
</html>
